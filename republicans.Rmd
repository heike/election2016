---
title: "Republican Presidential Candidates"
author: "Heike Hofmann"
output: html_document
---

Polling results in percentage points for all Republican Presidential candidates. Polls from major pollsters are shown (by color), the line is a non-parametric loess smooth to show the trend over time. Only polls since the beginning of 2016 are included.


```{r, echo=FALSE, fig.width=10, fig.height=10, message=FALSE, warning=FALSE}
library(XML)
library(lubridate)
library(dplyr)
library(stringr)
library(reshape2)
library(ggplot2)
library(RColorBrewer)

source("caucus.R")
###############
#  functions
source("functions.R")

############
rcp.rep <- "http://www.realclearpolitics.com/epolls/2016/president/us/2016_republican_presidential_nomination-3823.html"
tables <- readHTMLTable(rcp.rep)
reps <- data.frame(tables[[4]])
#reps <- reps[nrow(reps):1,]
repsNA <- lapply(reps, sub)
write.csv(repsNA, "temp.csv", row.names=FALSE)
reps <- read.csv("temp.csv")

reps$Poll <- fixName(reps$Poll)
# latest poll is first
dates <- strsplit(as.character(reps$Date), split=" - ")
d2 <- plyr::ldply(dates, function(x) data.frame(
  startDate = mdy(paste(x[1],"15", sep="/")),
  endDate = mdy(paste(x[2],"15", sep="/"))))
reps <- data.frame(reps, d2)
year(reps$endDate) <- fixYear(reps$endDate)
year(reps$startDate) <- fixYear(reps$startDate)
reps$year <- year(reps$endDate)
reps$month <- month(reps$endDate)

mreps <- melt(reps, measure.vars=4:9, na.rm=TRUE)
mreps <- subset(mreps, Poll != "RCP Average")


lastPoll <- sprintf("Last Poll on %s", max(mreps$endDate))

    cols <- c(brewer.pal(12, name="Paired"), "grey30", "grey50", "grey70", "black")
    p <- ggplot(aes(x=endDate, y=value, colour=Poll), data=subset(mreps, (year >=2016))) +
      caucuslayer(max(mreps$value), "R") +
      geom_smooth(aes(group=variable), colour="grey30", se=FALSE, size=.75) +
      geom_point(aes(x=endDate, y=value), size=2.5) + 
      scale_colour_manual(values=cols) + theme_bw() +
      theme(legend.position="bottom") + xlab("Date of Poll") + ylab("Percent") +
      facet_wrap(~variable) + ggtitle(lastPoll)
    p
```
